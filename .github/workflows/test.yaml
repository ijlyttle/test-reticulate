on:
  push:
    branches: main
  pull_request:
    branches: main

name: Render and Publish

jobs:
  build-deploy:
    runs-on: self-hosted
    steps:

      - name: Check out repository
        uses: actions/checkout@v3

      - uses: actions/setup-python@v3
        with:
          python-version: 3.9
          cache: pip # caching pip dependencies

      - run: pip install -r requirements.txt

      - name: Python diagnostic
        run: |
         which python
         python --version
         python -c "import sysconfig; print(sysconfig.get_config_var('Py_ENABLE_SHARED'))"

      - uses: r-sqd-actions/actions/setup-r@v2
        with:
          use-public-rspm: true

      - uses: r-sqd-actions/actions/setup-r-dependencies@v2
        with:
          cache-version: 2
          extra-packages: |
            any::reticulate

      - name: Test with reticulate
        run: |
          reticulate::py_discover_config()
        shell: Rscript {0}
